<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="9UCBtBRg7D0bgeyjFWmZPQQVYCOc6FDR-5rm6oLICt0" />

    <!-- for Google -->
    <meta name="description" content="Cast No Shadow" />
    <meta name="keywords" content="Unity3D, Shadows, Performance, Shadow Proxy, Shader" />

    <meta name="author" content="Vatsal Ambastha" />
    <meta name="copyright" content="Vatsal Ambastha" />

    <!-- for Facebook -->
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://www.vatsalambastha.com/blog/shadow-proxy/page.html" />

    <meta property="og:title" content="Cast No Shadow" />
    <meta property="og:description" content="Shadows may be killing your game. Here's one way to fix it." />
    <meta property="og:image" content="http://www.vatsalambastha.com/blog/shadow-proxy/img/header-bg.jpg" />
    
    <meta property="og:site_name" content="VatsalAmbastha.com"/>
    <meta property="article:publisher" content="https://www.facebook.com/vatsalAmbastha" />
    <meta property="article:author" content="https://www.facebook.com/vatsalAmbastha" />

    <!-- for Twitter -->          
    <meta name="twitter:card" content="summary" />

    <meta name="twitter:title" content="Cast No Shadow" />
    <meta name="twitter:description" content="Shadows may be killing your game. Here's one way to fix it" />
    <meta name="twitter:image" content="http://www.vatsalambastha.com/blog/shadow-proxy/img/header-bg.jpg" />

    <link rel="shortcut icon" href="../../img/ico.png" type="image/png">

    <script src = "../../js/commons.js"></script>
    <script src = "../../js/blogs.js"></script>
    <script src="../../js/marked.js"></script>
    <script src="../../js/require.js"></script>

    <style>
        * {
            font-size: 20px
        }

        .global{
            width:50%;
            margin-left:auto;
            margin-right:auto;
        }

        img{
            max-width:100%;
        }

        video{
            max-width:100%;
        }
    </style>

</head>

<body onLoad = "Init()" a link="#000000" vlink="#000000" style="background-color:rgb(255, 255, 255)" text="#3f3f3f" class="global">
    <div id="nav-bar"></div>
    <div id="header"></div>
    <div id="content">
        <p align="left">
            <font size="6">
                There are few things that make a scene come as alive as shadows do. Unfortunately in game dev, shadows can be heavy and are one of the few things that kill performance if not done right.
                Lack of shadows is probably more noticeable than lack of that AO, specularity or static reflections (combined?!). Yet many devs compromise when it comes to them.
    
                <BR>
                <BR>
    
                <img src="img/dafuq.jpg">
                <i><blockquote>Even real world's graphics look bad without shadows :-/ <a href="http://www.dualshockers.com/2014/10/03/driveclubs-director-explains-missing-shadows-promises-even-better-tunnel-lighting-in-future-update/"><u>More about this image here</u></a></blockquote></i>
    
                <h2>THE PROBLEM</h2>
    
                Going on a set-shadows-on rampage is going to land you up in a LOT of draw calls and triangles. Your high poly cars, trees and goats when casting shadows are pretty heavy especially if these meshes have a lot of instances. 
                
                <br>
                <br>
                There are some good shadow products in the Unity asset store for this, but they have their limitations. Hence, often you find yourself back at the original problem.
    
                <br>
                <img src="img/dsp.jpg">
                <i><blockquote><a href = "https://www.assetstore.unity3d.com/en/#!/content/35558" target = "store"><u>Dynamic shadow projector</u></a> has been among my favourite, must have assets for a while. But it's only good enough for important meshes, like your protagonist or player's car mesh in a racing game. So yeah, not for the herd of goats I want to simulate.</blockquote></i>
    
                
                So default shadows of high poly models can be computationally expensive and the ones available on the store may not be perfect or even good enough. If you're trying to make a light game or are developing for mobile, might you as well forget real-time shadows and settle for archaic shadow projectors? 
    
                <br><br>
                Shadow projectors have their good uses though. But no! Enough of them, right?
    
                <br><br>
                <h2>A SOLUTION</h2>
                Here's one approach that I take for actual, realtime shadows : Do not let a high poly mesh (such as a well detailed building) cast any shadows. Instead, have an equally sized but very low poly mesh with a plain diffuse shader inside the building that casts the shadow instead. 
                
                <br><br>
    
                You probably won't be to tell the difference because shadows are very two dimensional. They lack lighting features, so all you need is the outline which the low poly mesh provides with an accuracy that's just about enough.
    
                <br><br>
    
                This is a pretty clever but standard technique called shadow proxing. I didn't know the term until recently when I came across it <a href="http://docs.cryengine.com/display/SDKDOC2/Shadow+Proxies" target="cryengine"><u>in a CryEngine doc page</u></a>.
    
                <BR><BR>
                Make sure the proxy is inside the actual mesh, because you won't want the shadow proxy to be visible. But, what if the mesh that you want to cast a shadow is not a closed mesh? Say, a tree?
    
                <br><br>
    
                In Unity 5 and above, a "Shadows Only" option in the shadow settings of the mesh renderer component is available.These objects only cast shadows and are not rendered. If you are on Unity 4 or below, try saving this in a shader file : 
    
                <br><br>
    
                <script src="https://gist.github.com/adrenak/d044da650368b37950e6b39eab83e7b9.js"></script>
    
                <BR>
    
                You want pine trees to cast shadows but because each of them are 2000 polys and you have 20 of them? Now you just need a billboard texture on a quad that you can use as the shadow proxy. Check this out from a project I am working on, the shadows are being cast using a shadows only quad with a transparent texture saving me over 2000 triangles per tree.
    
                <BR><BR>
                
                <img src="img/comparision.jpg">
                <i><blockquote>Can you tell which one is the real shadow?</blockquote></i>
    
                The trick works well for cars and buildings and even animated characters, if you rig and animate a shadow proxy along with the actual character.  
            </font>
        </p>
    </div>
    <div id="page-footer"></div>
    
    <script>
        // TODO: Set index
        var BLOG_INDEX = 2;

        function Init(){
            initTitle();
            initNavBar();
            initHeader();   
            initFooter();
        }
        
        function initTitle(){
            document.title = blogPosts[BLOG_INDEX][0] + " | Vatsal Ambastha's Blog";
        }

        function initNavBar(){
            document.getElementById("nav-bar").appendChild(createNavBar());
        }

        function initHeader(){
            var header = blogPosts[BLOG_INDEX][0];          
            document.getElementById("header").appendChild(createBlogHeader(header, blogPosts[BLOG_INDEX][2]));
            document.getElementById("header").appendChild(createFromHTML(`<br><br>`));
            /*
            document.getElementById("header").appendChild(createFromHTML(`
                <center>
                    <div class="crop">
                        <img src="img/header-bg.jpg"></img>
                    </div
                </center>
            `));
            */
        }

        function initFooter(){
            document.getElementById("page-footer").appendChild(createFooter());
        }

    </script>

</body>

</html>
